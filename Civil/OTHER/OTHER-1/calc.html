<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Gradient & Slope Calculator | EngCalc.app</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo+Play:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* --- 1. VARIABLES & THEMES --- */
        :root {
            --bg-body: #ffffff;
            --bg-surface: #f8fafc;
            --text-main: #0f172a;   
            --text-muted: #475569;
            --brand-navy: #0f172a; 
            --brand-blue: #2563eb; 
            --brand-blue-light: rgba(37, 99, 235, 0.1);
            --border-color: #e2e8f0;
            --logo-text: #000000;
            --logo-dot: #2563eb;
            --grid-color: rgba(15, 23, 42, 0.05);
            --status-success-bg: #dcfce7;
            --status-success-text: #166534;
            --badge-bg: #e2e8f0;
            --badge-text: #475569;

            /* Graph Colors */
            --graph-bg: #ffffff;
            --graph-grid: #e2e8f0;
            --graph-line: #0f172a;
            --graph-fill: rgba(37, 99, 235, 0.15);
            --graph-axis: #64748b;
        }

        [data-theme="dark"] {
            --bg-body: #020617;        
            --bg-surface: #0f172a; 
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --brand-navy: #ffffff;
            --brand-blue: #60a5fa;
            --brand-blue-light: rgba(96, 165, 250, 0.15);
            --border-color: #1e293b;
            --logo-text: #ffffff;
            --logo-dot: #60a5fa;
            --grid-color: rgba(255, 255, 255, 0.05);
            --status-success-bg: #064e3b; 
            --status-success-text: #6ee7b7;
            --badge-bg: #1e293b;
            --badge-text: #94a3b8;

            /* Graph Colors Dark */
            --graph-bg: #1e293b;
            --graph-grid: #334155;
            --graph-line: #ffffff;
            --graph-fill: rgba(96, 165, 250, 0.15);
            --graph-axis: #64748b;
        }

        /* --- BLIND / HIGH CONTRAST MODE --- */
        [data-accessibility="blind"] {
            --bg-body: #ffffff !important;
            --bg-surface: #ffffff !important;
            --text-main: #000000 !important;
            --text-muted: #000000 !important;
            --brand-navy: #000000 !important;
            --brand-blue: #000000 !important;
            --brand-blue-light: transparent !important;
            --border-color: #000000 !important;
            --logo-text: #000000 !important;
            --logo-dot: #000000 !important;
            --grid-color: transparent !important;
            --status-success-bg: #ffffff !important;
            --status-success-text: #000000 !important;
            --badge-bg: #ffffff !important;
            --badge-text: #000000 !important;

            /* Graph High Contrast */
            --graph-bg: #ffffff !important;
            --graph-grid: #000000 !important;
            --graph-line: #000000 !important;
            --graph-fill: url(#hatchPattern) !important;
            --graph-axis: #000000 !important;
        }

        /* --- 2. RESET & BASE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        * { transition: background-color 0s, color 0s, border-color 0s; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            background-image: radial-gradient(var(--grid-color) 1px, transparent 1px);
            background-size: 24px 24px;
            min-height: 100vh;
            display: flex; flex-direction: column;
        }

        a { text-decoration: none; color: inherit; }
        button { border: none; background: none; cursor: pointer; font-family: inherit; }

        /* --- 3. NAVIGATION --- */
        nav {
            position: fixed;
            top: 0; left: 0; width: 100%;
            padding: 1rem 5%;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.01);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
        }
        [data-theme="dark"] nav { background: rgba(2, 6, 23, 0.7); }
        [data-accessibility="blind"] nav { background: white; border-bottom: 3px solid black; backdrop-filter: none; }

        .nav-group { display: flex; align-items: center; gap: 3rem; }
        .logo { font-family: 'Cairo Play', sans-serif; font-size: 1.6rem; font-weight: 700; display: flex; align-items: baseline; }
        .logo-main { color: var(--logo-text); }
        .logo-app { color: var(--logo-dot); }

        .back-link { display: flex; align-items: center; gap: 0.5rem; color: var(--text-muted); font-weight: 600; font-size: 0.9rem; }
        .back-link:hover { color: var(--brand-blue); }

        .nav-actions { display: flex; align-items: center; gap: 0.5rem; }

        .btn-nav-contact {
            display: inline-flex; align-items: center; gap: 0.5rem;
            font-size: 0.85rem; font-weight: 700; color: var(--brand-navy);
            border: 1px solid var(--border-color); padding: 0.6rem 1.2rem;
            border-radius: 50px; margin-right: 0.5rem; background: var(--bg-surface);
            transition: all 0.2s ease;
        }
        .btn-nav-contact:hover { background: var(--brand-blue); color: white; border-color: var(--brand-blue); transform: translateY(-2px); }
        [data-accessibility="blind"] .btn-nav-contact { border: 2px solid black; background: white; color: black; text-decoration: underline; }

        .icon-btn { width: 38px; height: 38px; border-radius: 50%; border: 1px solid var(--border-color); color: var(--text-main); display: flex; align-items: center; justify-content: center; }
        .icon-btn:hover { background-color: var(--brand-blue); color: white; border-color: var(--brand-blue); }

        /* --- 4. MAIN LAYOUT --- */
        main { padding: 8rem 5% 4rem; max-width: 1100px; margin: 0 auto; flex: 1; width: 100%; }

        .page-header { border-bottom: 1px solid var(--border-color); padding-bottom: 1.5rem; margin-bottom: 2rem; }
        .badges-row { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
        .badge { font-size: 0.75rem; background: var(--badge-bg); color: var(--badge-text); padding: 4px 10px; border-radius: 6px; font-weight: 600; }
        .badge-success { background-color: var(--status-success-bg); color: var(--status-success-text); }
        [data-accessibility="blind"] .badge { border: 1px solid black; background: white; color: black; }

        h1 { font-size: clamp(1.8rem, 4vw, 2.5rem); color: var(--brand-navy); font-weight: 800; line-height: 1.1; margin-bottom: 0.5rem; }
        .citation { color: var(--text-muted); font-size: 0.9rem; font-style: italic; }

        /* --- CALCULATOR GRID (50/50 Split) --- */
        .calc-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem; align-items: stretch; }

        .input-card, .diagram-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            display: flex; flex-direction: column;
        }
        .input-card { padding: 1.5rem; }
        .diagram-card { padding: 0; min-height: 400px; overflow: hidden; position: relative; justify-content: center; align-items: center; }
        [data-accessibility="blind"] .input-card, [data-accessibility="blind"] .diagram-card { border: 3px solid black; background: white; box-shadow: none; }

        /* Form Elements */
        .form-section-title { font-size: 0.95rem; font-weight: 700; color: var(--brand-blue); margin: 1rem 0 0.5rem; border-bottom: 1px dashed var(--border-color); padding-bottom: 5px; }
        [data-accessibility="blind"] .form-section-title { color: black; border-bottom: 2px solid black; }
        
        .coord-row { display: flex; gap: 10px; }
        .form-group { margin-bottom: 1rem; flex: 1; }
        .form-label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-main); }
        .form-input {
            width: 100%; padding: 0.8rem; border: 1px solid var(--border-color); border-radius: 8px; 
            background: var(--bg-body); color: var(--text-main); font-size: 0.95rem; font-family: inherit; font-weight: 600;
        }
        .form-input:focus { border-color: var(--brand-blue); outline: none; box-shadow: 0 0 0 3px var(--brand-blue-light); }
        [data-accessibility="blind"] .form-input { border: 2px solid black; background: white; color: black; }

        /* Buttons */
        .calc-actions { display: flex; justify-content: center; gap: 1rem; margin-top: 2rem; flex-wrap: wrap; }
        .btn-calc {
            padding: 1rem 3rem; font-size: 1.1rem; font-weight: 700; background-color: var(--brand-blue); 
            color: white; border: none; border-radius: 50px; cursor: pointer; transition: opacity 0.2s;
        }
        .btn-calc:hover { opacity: 0.9; }
        .btn-secondary { background: transparent; border: 2px solid var(--border-color); color: var(--text-main); display: none; align-items: center; gap: 8px; }
        .btn-secondary:hover { border-color: var(--brand-blue); color: var(--brand-blue); }
        [data-accessibility="blind"] .btn-calc { background: white; color: black; border: 3px solid black; font-weight: 900; }

        /* Results */
        .results-section { display: none; margin-top: 3rem; background: var(--bg-surface); border: 1px solid var(--border-color); border-radius: 12px; padding: 2.5rem; }
        .result-header { border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 2rem; font-size: 1.5rem; font-weight: 700; color: var(--brand-navy); }
        [data-accessibility="blind"] .results-section { border: 3px solid black; background: white; }
        
        .step-box { margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-body); border-radius: 8px; border: 1px solid var(--border-color); overflow-x: auto; }
        .step-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 1rem; color: var(--brand-blue); }
        [data-accessibility="blind"] .step-box { border: 2px solid black; }
        [data-accessibility="blind"] .step-title { color: black; text-decoration: underline; }

        .final-answer { 
            text-align: center; padding: 2rem; 
            background: var(--status-success-bg); color: var(--status-success-text); 
            border: 1px solid var(--border-color); border-radius: 12px; margin-top: 2rem; 
        }
        [data-accessibility="blind"] .final-answer { background: white; color: black; border: 3px solid black; font-weight: bold; }

        /* --- INFO SECTION --- */
        .info-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 2rem; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border-color);
        }
        .info-card {
            background: var(--bg-surface); border: 1px solid var(--border-color);
            border-radius: 12px; padding: 1.5rem;
        }
        .info-card h3 { color: var(--brand-navy); font-size: 1.2rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 10px; }
        .info-card h3 i { color: var(--brand-blue); }
        .info-card p { font-size: 0.9rem; line-height: 1.6; color: var(--text-muted); margin-bottom: 1rem; }
        .info-card ul { padding-left: 1.2rem; margin-bottom: 1rem; }
        .info-card li { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.5rem; }
        [data-accessibility="blind"] .info-card { border: 3px solid black; background: white; }

        /* --- GRAPH STYLES --- */
        #graphSvg { background-color: var(--graph-bg); }
        .grid-line { stroke: var(--graph-grid); stroke-width: 1; }
        .axis-line { stroke: var(--graph-axis); stroke-width: 2; }
        .plot-fill { fill: var(--graph-fill); }
        .plot-line { stroke: var(--graph-line); stroke-width: 3; stroke-linecap: round; }
        .plot-point { fill: var(--brand-blue); stroke: var(--bg-body); stroke-width: 2; }
        .axis-text { font-size: 11px; fill: var(--text-muted); font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 600; }
        .axis-number { font-size: 10px; fill: var(--text-muted); font-family: 'Plus Jakarta Sans', sans-serif; }
        .axis-title { font-size: 12px; fill: var(--text-main); font-weight: 700; text-anchor: middle; }

        @media (max-width: 900px) {
            .calc-layout { grid-template-columns: 1fr; }
            main { padding-top: 6rem; padding-left: 1rem; padding-right: 1rem; }
            .diagram-card { min-height: 350px; }
        }
        @media (max-width: 480px) { .btn-nav-contact { display: none; } }

        /* Footer */
        footer { border-top: 1px solid var(--border-color); text-align: center; background: var(--bg-body); padding: 4rem 5%; margin-top: auto; }
        .footer-logo { justify-content: center; margin-bottom: 0.5rem; }
    </style>
</head>
<body data-theme="light">

    <nav>
        <div class="nav-group">
            <a href="https://www.engcalc.app" class="logo">
                <span class="logo-main">EngCalc</span><span class="logo-app">.app</span>
            </a>
            <a href="https://www.engcalc.app/Civil/OTHER" class="back-link"><i class="fa-solid fa-arrow-left"></i> Hub</a>
        </div>

        <div class="nav-actions">
            <a href="https://www.engcalc.app/report" class="btn-nav-contact">Contact Us</a>
            <button class="icon-btn" id="themeToggle" aria-label="Toggle Dark Mode"><i class="fa-solid fa-moon"></i></button>
            <button class="icon-btn" id="accessToggle" aria-label="Toggle Accessibility Mode"><i class="fa-solid fa-eye"></i></button>
        </div>
    </nav>

    <main id="main-content">
        
        <div class="page-header">
            <div class="badges-row">
                <span class="badge">ID: OTHER-1</span>
                <span class="badge">Method: Standard Geometry</span>
                <span class="badge">Author: Anas Al Fulaiti</span>
                <span class="badge badge-success"><i class="fa-solid fa-check"></i> Checked by: James W. (12/JAN/2026)</span>
            </div>
            <h1>Gradient & Slope Calculator</h1>
            <p class="citation">Calculate slope, gradient, angle, linear function, and Euclidean distance between two cartesian coordinates.</p>
        </div>

        <div class="calc-layout">
            
            <div class="input-card">
                <div class="form-section-title">Coordinate 1 ($P_1$)</div>
                <div class="coord-row">
                    <div class="form-group">
                        <label class="form-label">X1</label>
                        <input type="number" id="x1" class="form-input" value="0" oninput="updateGraphLive()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Y1</label>
                        <input type="number" id="y1" class="form-input" value="0" oninput="updateGraphLive()">
                    </div>
                </div>

                <div class="form-section-title">Coordinate 2 ($P_2$)</div>
                <div class="coord-row">
                    <div class="form-group">
                        <label class="form-label">X2</label>
                        <input type="number" id="x2" class="form-input" value="5" oninput="updateGraphLive()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Y2</label>
                        <input type="number" id="y2" class="form-input" value="10" oninput="updateGraphLive()">
                    </div>
                </div>
            </div>

            <div class="diagram-card">
                <svg width="100%" height="100%" viewBox="0 0 500 400" id="graphSvg" preserveAspectRatio="xMidYMid meet">
                    <defs>
                        <pattern id="hatchPattern" patternUnits="userSpaceOnUse" width="10" height="10" patternTransform="rotate(45)">
                            <line x1="0" y1="0" x2="0" y2="10" stroke="black" stroke-width="2" />
                        </pattern>
                    </defs>
                    <g id="gridLayer"></g>
                    <path id="areaFill" class="plot-fill" d="" />
                    <line id="slopeLine" class="plot-line" />
                    <path id="projLines" fill="none" stroke="var(--text-muted)" stroke-dasharray="4,4" stroke-width="1" d="" />
                    <circle id="p1_dot" class="plot-point" r="5" />
                    <circle id="p2_dot" class="plot-point" r="5" />
                    <text id="p1_text" class="axis-text" text-anchor="middle"></text>
                    <text id="p2_text" class="axis-text" text-anchor="middle"></text>
                    <text id="x_axis_title" class="axis-title" x="250" y="390">X - Axis</text>
                    <text id="y_axis_title" class="axis-title" x="15" y="200" transform="rotate(-90, 15, 200)">Y - Axis</text>
                </svg>
            </div>
        </div>

        <div class="calc-actions">
            <button class="btn-calc" onclick="calculateResult()">Calculate Result</button>
            <button class="btn-calc btn-secondary print-btn-trigger">
                <i class="fa-solid fa-file-pdf"></i> Download PDF
            </button>
        </div>

        <div id="results" class="results-section">
            <div class="result-header">Calculation Results</div>
            <div id="calculation-steps"></div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn-calc btn-secondary print-btn-trigger" style="display: inline-flex;">
                    <i class="fa-solid fa-file-pdf"></i> Download Result as PDF
                </button>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <h3><i class="fa-solid fa-calculator"></i> Mathematical Formulas</h3>
                <p>The calculation is based on standard analytic geometry principles for 2D Cartesian space.</p>
                <ul>
                    <li><strong>Slope ($m$):</strong> $$ m = \frac{Rise}{Run} = \frac{y_2 - y_1}{x_2 - x_1} $$</li>
                    <li><strong>Angle ($\theta$):</strong> $$ \theta = \tan^{-1}(m) $$</li>
                    <li><strong>Distance ($d$):</strong> $$ d = \sqrt{(x_2-x_1)^2 + (y_2-y_1)^2} $$</li>
                    <li><strong>Equation:</strong> $y = mx + b$</li>
                </ul>
            </div>

            <div class="info-card">
                <h3><i class="fa-solid fa-book-open"></i> Key Concepts</h3>
                <p><strong>Gradient vs. Slope:</strong> In mathematics, these terms are often interchangeable. In civil engineering, "Gradient" is often expressed as a percentage or ratio (e.g., 1:50) for roads and pipes, while "Slope" is the raw numerical value ($m$).</p>
                <p><strong>Rise & Run:</strong> "Rise" is the vertical change ($\Delta y$) and "Run" is the horizontal change ($\Delta x$) between two points.</p>
            </div>

            <div class="info-card">
                <h3><i class="fa-solid fa-list-check"></i> How to Use</h3>
                <ol>
                    <li><strong>Enter Coordinates:</strong> Input the X and Y values for Point 1 (Start) and Point 2 (End).</li>
                    <li><strong>Visual Verification:</strong> The graph updates in real-time. Ensure the visual representation matches your expectation.</li>
                    <li><strong>Calculate:</strong> Click "Calculate Result" to generate the slope, angle, and line equation.</li>
                    <li><strong>Export:</strong> Use the "Download PDF" feature to save a formal calculation report.</li>
                </ol>
            </div>
        </div>

    </main>

    <footer>
        <div class="logo footer-logo">
            <span class="logo-main">EngCalc</span><span class="logo-app">.app</span>
        </div>
        <p class="footer-text">&copy; 2026 EngCalc.app. Built for the Civil Engineering Community.</p>
    </footer>

    <script>
        // --- 1. THEME & ACCESSIBILITY ---
        const themeBtn = document.getElementById('themeToggle');
        const accessBtn = document.getElementById('accessToggle');
        const body = document.body;

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            body.setAttribute('data-theme', savedTheme);
            themeBtn.innerHTML = savedTheme === 'dark' ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
        }

        themeBtn.addEventListener('click', () => {
            const isDark = body.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeBtn.innerHTML = isDark ? '<i class="fa-solid fa-moon"></i>' : '<i class="fa-solid fa-sun"></i>';
            updateGraphLive(); 
        });

        accessBtn.addEventListener('click', () => {
            const isBlind = body.getAttribute('data-accessibility') === 'blind';
            if(isBlind) {
                body.removeAttribute('data-accessibility');
                accessBtn.innerHTML = '<i class="fa-solid fa-eye"></i>';
            } else {
                body.setAttribute('data-accessibility', 'blind');
                accessBtn.innerHTML = '<i class="fa-solid fa-eye-slash"></i>';
            }
        });

        // --- 2. LIVE GRAPH UPDATE ---
        function updateGraphLive() {
            const x1 = parseFloat(document.getElementById('x1').value) || 0;
            const y1 = parseFloat(document.getElementById('y1').value) || 0;
            const x2 = parseFloat(document.getElementById('x2').value) || 0;
            const y2 = parseFloat(document.getElementById('y2').value) || 0;

            drawGraph(x1, y1, x2, y2);
        }

        function drawGraph(x1, y1, x2, y2) {
            const gridLayer = document.getElementById('gridLayer');
            
            // Viewport Settings
            const w = 500; const h = 400; const pad = 50;

            // Bounds Calculation
            let minX = Math.min(x1, x2, 0); let maxX = Math.max(x1, x2, 0);
            let minY = Math.min(y1, y2, 0); let maxY = Math.max(y1, y2, 0);

            // Add margin (10%)
            let spanX = maxX - minX; if(spanX===0) spanX=10;
            let spanY = maxY - minY; if(spanY===0) spanY=10;
            minX -= spanX * 0.1; maxX += spanX * 0.1;
            minY -= spanY * 0.1; maxY += spanY * 0.1;
            spanX = maxX - minX; spanY = maxY - minY;

            // Mapping
            const mapX = (v) => pad + ((v - minX) / spanX) * (w - 2*pad);
            const mapY = (v) => (h - pad) - ((v - minY) / spanY) * (h - 2*pad);

            // Draw Grid & Numbers
            gridLayer.innerHTML = '';
            for(let i=0; i<=5; i++){
                // Vertical Lines (X axis ticks)
                let valX = minX + (spanX * i/5);
                let px = mapX(valX);
                gridLayer.appendChild(createSVG('line', {x1:px, y1:pad, x2:px, y2:h-pad, class:'grid-line'}));
                
                // Number Label X
                let txtX = createSVG('text', {
                    x: px, 
                    y: h - pad + 15, // Position below axis
                    class: 'axis-number', 
                    'text-anchor': 'middle'
                });
                txtX.textContent = Math.round(valX * 10) / 10; 
                gridLayer.appendChild(txtX);

                // Horizontal Lines (Y axis ticks)
                let valY = minY + (spanY * i/5);
                let py = mapY(valY);
                gridLayer.appendChild(createSVG('line', {x1:pad, y1:py, x2:w-pad, y2:py, class:'grid-line'}));

                // Number Label Y
                let txtY = createSVG('text', {
                    x: pad - 8, // Position left of axis
                    y: py + 3,  // Center vertically relative to line
                    class: 'axis-number', 
                    'text-anchor': 'end'
                });
                txtY.textContent = Math.round(valY * 10) / 10; 
                gridLayer.appendChild(txtY);
            }

            // Draw Axes at 0 if visible
            let originX = mapX(0); let originY = mapY(0);
            if(minX <= 0 && maxX >= 0) gridLayer.appendChild(createSVG('line', {x1:originX, y1:pad, x2:originX, y2:h-pad, class:'axis-line'}));
            if(minY <= 0 && maxY >= 0) gridLayer.appendChild(createSVG('line', {x1:pad, y1:originY, x2:w-pad, y2:originY, class:'axis-line'}));

            // Points Mapped
            const px1 = mapX(x1); const py1 = mapY(y1);
            const px2 = mapX(x2); const py2 = mapY(y2);
            const pyBase = mapY(0);

            // Draw Shaded Area (Clamp base to viewport)
            let baseDraw = Math.min(Math.max(pyBase, pad), h-pad);
            const pathD = `M ${px1},${baseDraw} L ${px1},${py1} L ${px2},${py2} L ${px2},${baseDraw} Z`;
            document.getElementById('areaFill').setAttribute('d', pathD);

            // Update Lines & Dots
            setAttrs('slopeLine', {x1:px1, y1:py1, x2:px2, y2:py2});
            setAttrs('projLines', {d: `M ${px1},${py1} L ${px2},${py1} L ${px2},${py2}`}); // L-Shape projection
            setAttrs('p1_dot', {cx:px1, cy:py1});
            setAttrs('p2_dot', {cx:px2, cy:py2});

            // Update Labels
            const lbl1 = document.getElementById('p1_text');
            lbl1.textContent = `P1(${x1},${y1})`;
            lbl1.setAttribute('x', px1); lbl1.setAttribute('y', py1 - 15);

            const lbl2 = document.getElementById('p2_text');
            lbl2.textContent = `P2(${x2},${y2})`;
            lbl2.setAttribute('x', px2); lbl2.setAttribute('y', py2 - 15);
        }

        // --- 3. CALCULATE RESULT (Button Click) ---
        function calculateResult() {
            const x1 = parseFloat(document.getElementById('x1').value);
            const y1 = parseFloat(document.getElementById('y1').value);
            const x2 = parseFloat(document.getElementById('x2').value);
            const y2 = parseFloat(document.getElementById('y2').value);

            const dx = x2 - x1;
            const dy = y2 - y1;

            let m_text, ratio1, ratio2, angleVal, funcStr;

            if (Math.abs(dx) < 1e-9) {
                m_text = "\\infty";
                ratio1 = "1 : 0";
                ratio2 = "N/A";
                angleVal = "90.00";
                funcStr = `x = ${x1}`;
            } else {
                let m = dy / dx;
                m_text = m.toFixed(3);
                
                // Ratio 1: Civil Format (1 Horizontal : n Vertical) => 1 : m
                ratio1 = `1 : ${Math.abs(m).toFixed(2)}`;

                // Ratio 2: Inverse (1 Vertical : n Horizontal) => 1 : 1/m
                if (Math.abs(m) > 1e-9) ratio2 = `1 : ${(1/Math.abs(m)).toFixed(2)}`;
                else ratio2 = "1 : âˆž";

                angleVal = (Math.atan(m) * (180 / Math.PI)).toFixed(2);
                
                let b = y1 - (m * x1);
                let sign = b >= 0 ? "+" : "-";
                funcStr = `y = ${m.toFixed(2)}x ${sign} ${Math.abs(b).toFixed(2)}`;
            }

            const dist = Math.sqrt(dx*dx + dy*dy).toFixed(3);

            const stepsHtml = `
                <div class="step-box">
                    <div class="step-title">1. Gradient & Ratios</div>
                    <p>$$ m = \\frac{y_2 - y_1}{x_2 - x_1} = \\frac{${dy}}{${dx}} = \\mathbf{${m_text}} $$</p>
                    <p><strong>Civil Format (1 Horizontal : n Vertical):</strong> ${ratio1}</p>
                    <p><strong>Standard Format (1 Vertical : n Horizontal):</strong> ${ratio2}</p>
                </div>
                <div class="step-box">
                    <div class="step-title">2. Linear Function</div>
                    <p>Equation: $$ \\mathbf{${funcStr}} $$</p>
                    <p>Angle: $$ \\theta = \\tan^{-1}(${m_text}) = \\mathbf{${angleVal}^\\circ} $$</p>
                </div>
                <div class="final-answer">
                    <div>Resultant Distance</div>
                    <div style="font-size:1.3em; margin-top:10px;">$$ d = \\sqrt{(${dx})^2 + (${dy})^2} = \\mathbf{${dist}} $$</div>
                </div>
            `;

            document.getElementById('calculation-steps').innerHTML = stepsHtml;
            document.getElementById('results').style.display = 'block';
            document.querySelectorAll('.btn-secondary').forEach(b => b.style.display = 'inline-flex');
            
            MathJax.typesetPromise();
            document.getElementById('results').scrollIntoView({behavior: "smooth"});
        }

        // Helpers
        function createSVG(type, attrs) {
            const el = document.createElementNS("http://www.w3.org/2000/svg", type);
            for(let k in attrs) el.setAttribute(k, attrs[k]);
            return el;
        }
        function setAttrs(id, attrs) {
            const el = document.getElementById(id);
            for(let k in attrs) el.setAttribute(k, attrs[k]);
        }

        // --- 4. PDF POPUP LOGIC ---
        document.addEventListener('DOMContentLoaded', function() {
            updateGraphLive(); // Init graph

            const printBtns = document.querySelectorAll('.print-btn-trigger');
            printBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const headContent = document.head.innerHTML;
                    const mainContent = document.getElementById('main-content').cloneNode(true);
                    
                    // Remove the info grid for the PDF report
                    const infoGrid = mainContent.querySelector('.info-grid');
                    if(infoGrid) infoGrid.remove();

                    const resultsSec = mainContent.querySelector('.results-section');
                    if(resultsSec) resultsSec.style.display = 'block';

                    const win = window.open('', '', 'height=800,width=1000');
                    if (win) {
                        win.document.write('<html><head>');
                        win.document.write('<title>Gradient Report</title>');
                        win.document.write(headContent);
                        // PDF CSS
                        win.document.write(`
                            <style>
                                body { background: white; margin: 0; padding: 20px; font-family: 'Plus Jakarta Sans', sans-serif; }
                                .calc-actions, .nav-actions, .back-link, .print-btn-trigger { display: none !important; }
                                .calc-layout { display: grid !important; grid-template-columns: 1fr 1fr; gap: 20px; }
                                .input-card, .diagram-card { border: 1px solid #ccc; width: 100%; min-height: 300px; padding: 10px; box-shadow:none; }
                                .results-section { display: block !important; border: 1px solid #ccc; padding: 15px; margin-top: 15px; }
                                .step-box { border: 1px solid #eee; }
                            </style>
                        `);
                        win.document.write('</head><body>');
                        win.document.write('<main>' + mainContent.innerHTML + '</main>');
                        win.document.write('</body></html>');
                        win.document.close();
                        win.focus();
                        setTimeout(function(){ win.print(); }, 1000);
                    } else {
                        alert("Please allow popups to download the PDF.");
                    }
                });
            });
        });
    </script>
</body>
</html>